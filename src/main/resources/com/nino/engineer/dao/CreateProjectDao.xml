<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nino.engineer.dao.CreateProjectDao">
    <!-- 匹配用户权限-->
    <select id="Matching_user_rights" resultType="java.lang.Integer">
    select j_id from jurisdiction where id = (select j_id from permissions_association where u_id = #{u_id})
</select>

    <!-- 为超管||管理显示所有的项目 -->
    <select id="DisplayAllProject" resultType="com.nino.engineer.domain.Project">
select id,p_name,p_creator,p_time,l_id,p_weather,p_ambient from project
</select>

    <!-- 根据项目id查询 -->
    <select id="According_toID" resultType="com.nino.engineer.domain.Project">
        select
        id,p_name,p_creator,p_time,l_id,p_weather,p_ambient
        from project
        where
        id in
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>

    <!-- 查询项目名是否重复-->
    <select id="IsRepeat" resultType="com.nino.engineer.domain.Project">
select id,p_name,p_creator,p_time,l_id,p_weather,p_ambient from project where p_name = #{_parameter}
</select>

    <!-- 添加地址数据 -->
    <insert id="Add_address_info" parameterType="com.nino.engineer.domain.Location" flushCache="true"
            useGeneratedKeys="true" keyProperty="id">
insert into
location(u_id,username,l_Building,l_layer,l_household,l_detailed,project_location,l_region,l_detailed_address)
values
(
#{u_id},
#{username},
#{l_Building},
#{l_layer},
#{l_household},
#{l_detailed},
#{project_location},
#{l_region},
#{l_detailed_address}
)
</insert>

    <!-- 添加项目信息-->
    <insert id="Create_Project" parameterType="com.nino.engineer.domain.Project" flushCache="true"
            useGeneratedKeys="true" keyProperty="id">
insert into
project(p_name,p_creator_id,p_time,l_id,p_weather,p_ambient)
values
(
#{p_name},
#{p_creator_id},
#{p_time},
#{l_id},
#{p_weather},
#{p_ambient}
)
</insert>

    <!-- 添加项目状态信息 -->
    <insert id="AddProjectStatusInfo" parameterType="com.nino.engineer.domain.Project_status" flushCache="true"
            useGeneratedKeys="true" keyProperty="id">
insert into
project_status(u_id,username,p_id,p_s)
values
(
#{u_id},
#{username},
#{p_id},
#{p_s}
)
</insert>

    <!-- 添加项目权限信息 -->
    <insert id="Add_project_permission_information" parameterType="com.nino.engineer.domain.Permissions_detailed"
            flushCache="true">
insert into
permissions_detailed(u_id,username,j_id,p_id)
values
(
#{u_id},
#{username},
#{j_id},
#{p_id}
)
</insert>

    <!-- 查询项目总数(管理员查全部) -->
    <select id="projectNumber">
        select count(*) from project
    </select>

    <!-- 添加项目信息 -->
    <insert id="AddProject_progressInfo" parameterType="com.nino.engineer.domain.Project_progress" flushCache="true">
        insert into
        project_progress(u_id,username,p_id,p_time,p_weather,l_id,p_ambient,p_describe,p_else)
        values
        (
        #{u_id},
        #{username},
        #{p_id},
        #{p_time},
        #{p_weather},
        #{l_id},
        #{p_ambient},
        #{p_describe},
        #{p_else}
        )
    </insert>

    <!-- 根据项目ID查询该项目是否隐藏(已完成) -->
    <select id="Lookup_all" resultType="com.nino.engineer.domain.Project_status">
        select id,u_id,username,p_id,p_s from project_status ${_parameter}
    </select>

    <!-- 筛选出所有 未完成的(可见) -->
    <select id="Screening_content" resultType="com.nino.engineer.domain.Project_status">
        select id,u_id,username,p_id,p_s from project_status where u_id = #{u_id} and p_s = '未完成'
    </select>

    <!-- 添加项目状态信息 -->
    <insert id="Add_project_statusInfo" parameterType="com.nino.engineer.domain.Project_status" flushCache="true" useGeneratedKeys="true" keyProperty="id">
        insert into
        project_status(u_id,username,p_id,p_s)
        values
        (
        #{u_id},
        #{username},
        #{p_id},
        #{p_s}
        )
    </insert>
</mapper>